# Js 执行环境

- `execution context(EC)`:**执行环境**/或者称为**执行上下文**，**全局执行环境**是最外围的一个执行环境，**每个函数有自己的执行环境**，当执行流进入一个函数时，函数的执行环境就会被推入一个**环境栈（ECS）**,函数执行完，（ECS）将该函数的执行环境弹出，把控制权返回给之前的执行环境。
ECS栈演示：
```javascript
function fun3() {}

function fun2() {
  fun3()
}

function fun1() {
  fun2()
}
fun1()
```
入栈过程
```javascript
ECStatck = [
  fun3,
  fun2,
  fun1,
  globalContext（全局执行环境GO）
]
```

每个执行环境都有一个与之关联的 **变量对象**`variable object (VO）`,环境中定义的所有变量和函数都保存在这个对象中,当代码在一个环境中执行时会创建变量对象的一个**作用域链（scopr chain）**

| 全局VO                                   | ... ... | ... ... | ... ... | 最前端的VO |
| ---------------------------------------- | ------- | ------- | ------- | ---------- |
| 检索变量时从最前端的VO开始，逐级向后回溯 | ⬅️       | ⬅️       | ⬅️       | ⬅️          |

- 如果是函数的执行环境，则将**活动对象**` activation object （AO）`作为**变量对象**  `variable object （VO）`

- 用 AO VO GO EC 也可以解释闭包：当一个函数内部返回一个函数时，函数的执行环境是出栈了，但是该函数的AO VO还存在（外部随时可能用到，故不能回收）这就能访问到该执行环境的变量了